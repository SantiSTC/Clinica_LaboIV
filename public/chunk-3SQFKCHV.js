import{a as A,c as f,d as g,f as h,g as m,h as M}from"./chunk-DGYUBMNP.js";import{b as v}from"./chunk-7YO6BCT5.js";import{b as y,q as b,t as $,u as R}from"./chunk-BMMUWXGF.js";import{g as s}from"./chunk-5G567QLT.js";var j=(()=>{let r=class r{constructor(t){this.auth=t,this.uploadProgress$=y,this.downloadURL$=y,this.storage=R(A)}subirFoto(t,o,a,c="perfil"){return s(this,null,function*(){if(t){let n=t.type.split("/")[1];try{let e=`imagenes/${o}/${a}/${c}.${n}`;var u=m(this.storage,e);let l={customMetadata:{uploadedBy:a,uploadedAt:new Date().toLocaleDateString()+" "+new Date().toLocaleTimeString()}};M(u,t,l).on("state_changed",d=>{let p=d.bytesTransferred/d.totalBytes*100;console.log(`Progreso de subida: ${p.toString()}%`)})}catch(e){console.error("Error al subir la foto",e)}finally{}}else throw console.error("No se seleccion\xF3 ning\xFAn archivo"),new Error("No se seleccion\xF3 ning\xFAn archivo")})}obtenerFotosDelUsuario(t,o){return s(this,null,function*(){try{t=="paciente"&&(t="pacientes");let a=m(this.storage,`imagenes/${t}/${o}`),c=yield h(a);return yield Promise.all(c.items.map(n=>s(this,null,function*(){let e=yield f(n),l=g(n),i=(yield l).customMetadata?.uploadedBy||"Unknown",d=(yield l).customMetadata?.uploadedAt||"Unknown";return{url:e,uploadedBy:i,uploadedAt:d}})))}catch(a){throw console.error("Error al listar las fotos",a),a}})}obtenerTodasLasFotos(t){return s(this,null,function*(){let o=[],a=m(this.storage,`imagenes/${t}`),c=u=>s(this,null,function*(){let n=yield h(u),e=n.items.map(i=>s(this,null,function*(){let d=yield f(i),p=yield g(i),U=p.customMetadata?.uploadedBy||"Unknown",B=p.customMetadata?.uploadedAt||"Unknown";return{url:d,uploadedBy:U,uploadedAt:B}})),l=yield Promise.all(e);o=o.concat(l);for(let i of n.prefixes)yield c(i)});return yield c(a),o})}};r.\u0275fac=function(o){return new(o||r)($(v))},r.\u0275prov=b({token:r,factory:r.\u0275fac,providedIn:"root"});let w=r;return w})();export{j as a};
